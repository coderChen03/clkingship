"use strict";(self.webpackChunkclkingship=self.webpackChunkclkingship||[]).push([[377],{"./src/components/Form/form.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>form_stories});var react=__webpack_require__("./node_modules/react/index.js"),dist_web=__webpack_require__("./node_modules/async-validator/dist-web/index.js"),mapValues=__webpack_require__("./node_modules/lodash-es/mapValues.js"),forEach=__webpack_require__("./node_modules/lodash-es/forEach.js");function fieldReducer(state,action){switch(action.type){case"addField":return{...state,[action.name]:{...action.value}};case"updateValue":return{...state,[action.name]:{...state[action.name],value:action.value}};case"updateValidateResult":const{isValid,errors}=action.value;return{...state,[action.name]:{...state[action.name],isValid,errors}};default:return state}}const Form_useStore=function useStore(initialValue){const[form,setForm]=(0,react.useState)({isValid:!0,isSubmitting:!1,errors:{}}),[fields,dispatch]=(0,react.useReducer)(fieldReducer,{}),getFieldValue=key=>fields[key]&&fields[key].value,transfromRules=rules=>rules.map((rule=>{if("function"==typeof rule){return rule({getFieldValue})}return rule}));return{fields,dispatch,form,validateField:async name=>{const{value,rules}=fields[name],descriptor={[name]:transfromRules(rules)},validator=new dist_web.A(descriptor);let isValid=!0,errors=[];try{await validator.validate({[name]:value})}catch(e){isValid=!1,errors=e.errors}finally{dispatch({type:"updateValidateResult",name,value:{isValid,errors}})}},getFieldValue,validateAllField:async()=>{let isValid=!0,errors={};const valueMaps=(0,mapValues.A)(fields,(item=>item.value)),descriptor=(0,mapValues.A)(fields,(item=>transfromRules(item.rules))),validator=new dist_web.A(descriptor);setForm({...form,isSubmitting:!0});try{await validator.validate(valueMaps)}catch(e){isValid=!1,errors=e.fields,(0,forEach.A)(fields,((value,name)=>{errors[name]?dispatch({type:"updateValidateResult",name,value:{isValid:!1,errors:errors[name]}}):value.rules.length>0&&!errors[name]&&dispatch({type:"updateValidateResult",name,value:{isValid:!0,errors:[]}})}))}finally{return setForm({...form,isSubmitting:!1,isValid,errors}),{isValid,errors,values:valueMaps}}},getFieldsValue:()=>(0,mapValues.A)(fields,(item=>item.value)),setFieldValue:(name,value)=>{fields[name]&&dispatch({type:"updateValue",name,value})},resetFieldValue:()=>{(0,forEach.A)(initialValue,((value,name)=>{fields[name]&&dispatch({type:"updateValue",name,value})}))}}};var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const FormContext=(0,react.createContext)({}),Form=(0,react.forwardRef)(((props,ref)=>{const{name,children,initialValue,onFinish,onFinishFailed}=props,{form,fields,dispatch,...restProps}=Form_useStore(initialValue);let{validateField,validateAllField}=restProps;(0,react.useImperativeHandle)(ref,(()=>({...restProps})));const passedContext={dispatch,initialValue,fields,validateField};let childrenNode;return childrenNode="function"==typeof children?children(form):children,(0,jsx_runtime.jsx)("form",{name,className:"clking-form",onSubmit:async e=>{e.preventDefault(),e.stopPropagation();let{isValid,errors,values}=await validateAllField();isValid?onFinish&&onFinish(values):onFinishFailed&&onFinishFailed(values,errors)},children:(0,jsx_runtime.jsx)(FormContext.Provider,{value:passedContext,children:childrenNode})})}));Form.defaultProps={name:"clking-form"};const Form_form=Form;Form.__docgenInfo={description:"高性能表单控件，自带数据域管理。包含数据录入、校验以及对应样式。\r\n\r\n```javascript\r\nimport { Form } from 'clkingship'\r\n\r\n//然后可以使用 Form.Item 进行子 form的使用\r\n```",methods:[],displayName:"Form",props:{name:{required:!1,tsType:{name:"string"},description:"表单名称，会作为表单字段 id 前缀使用",defaultValue:{value:'"clking-form"',computed:!1}},initialValue:{required:!1,tsType:{name:"Record",elements:[{name:"string"},{name:"any"}],raw:"Record<string, any>"},description:"表单默认值，只有初始化以及重置时生效"},onFinish:{required:!1,tsType:{name:"signature",type:"function",raw:"(values: Record<string, any>) => void",signature:{arguments:[{type:{name:"Record",elements:[{name:"string"},{name:"any"}],raw:"Record<string, any>"},name:"values"}],return:{name:"void"}}},description:"提交表单且数据验证成功后回调事件"},onFinishFailed:{required:!1,tsType:{name:"signature",type:"function",raw:"(values: Record<string, any>, errors: Record<string, ValidateError[]>) => void",signature:{arguments:[{type:{name:"Record",elements:[{name:"string"},{name:"any"}],raw:"Record<string, any>"},name:"values"},{type:{name:"Record",elements:[{name:"string"},{name:"Array",elements:[{name:"ValidateError"}],raw:"ValidateError[]"}],raw:"Record<string, ValidateError[]>"},name:"errors"}],return:{name:"void"}}},description:"提交表单且数据验证失败后回调事件"},children:{required:!1,tsType:{name:"union",raw:"React.ReactNode | renderProps",elements:[{name:"ReactReactNode",raw:"React.ReactNode"},{name:"signature",type:"function",raw:"(form: FormState) => React.ReactNode",signature:{arguments:[{type:{name:"FormState"},name:"form"}],return:{name:"ReactReactNode",raw:"React.ReactNode"}}}]},description:""},ref:{required:!0,tsType:{name:"any"},description:""}}};var classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames);const FormItem=props=>{const{label,name,children,valuePropName,trigger,getValueFromEvent,rules,validateTrigger}=props,{dispatch,fields,initialValue,validateField}=(0,react.useContext)(FormContext),rowClass=classnames_default()("clking-row",{"clking-row-no-label":!label});(0,react.useEffect)((()=>{let value=initialValue?initialValue[name]:"";dispatch({type:"addField",name,value:{label,name,value,rules,errors:[],isValid:!0}})}),[dispatch]);const fieldState=fields[name],value=fieldState&&fieldState.value;let errors=fieldState&&fieldState.errors,isRequired=null==rules?void 0:rules.some((rule=>"function"!=typeof rule&&rule.required)),hasError=errors&&errors.length>0;const labelClass=classnames_default()({"clking-form-item-required":isRequired}),itemClass=classnames_default()("clking-form-item-control",{"clking-form-item-has-error":hasError}),onValueValidate=async()=>{await validateField(name)},controlProps={[valuePropName]:value,[trigger]:e=>{let value=getValueFromEvent(e);dispatch({type:"updateValue",name,value})}};rules&&(controlProps[validateTrigger]=onValueValidate);const childList=react.Children.toArray(children);0===childList.length&&console.error("No child element found in Form.Item, please provide one form component"),childList.length>1&&console.warn("Only support one child element in Form.Item, others will be omitted"),react.isValidElement(childList[0])||console.error("Child component is not a valid React Element");const child=childList[0],returnChildNode=react.cloneElement(child,{...child.props,...controlProps});return(0,jsx_runtime.jsxs)("div",{className:rowClass,children:[label&&(0,jsx_runtime.jsx)("div",{className:"clking-form-item-label",children:(0,jsx_runtime.jsx)("label",{title:label,className:labelClass,children:label})}),(0,jsx_runtime.jsxs)("div",{className:"clking-form-item",children:[(0,jsx_runtime.jsx)("div",{className:itemClass,children:returnChildNode}),hasError&&(0,jsx_runtime.jsx)("div",{className:"clking-form-item-explain",children:(0,jsx_runtime.jsx)("span",{children:errors[0].message})})]})]})};FormItem.defaultProps={valuePropName:"value",trigger:"onChange",validateTrigger:"onBlur",getValueFromEvent:e=>e.target.value,rules:[]};const formItem=FormItem;FormItem.__docgenInfo={description:"",methods:[],displayName:"FormItem",props:{name:{required:!0,tsType:{name:"string"},description:""},label:{required:!1,tsType:{name:"string"},description:""},children:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},valuePropName:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'"value"',computed:!1}},trigger:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'"onChange"',computed:!1}},getValueFromEvent:{required:!1,tsType:{name:"signature",type:"function",raw:"(e: any) => any",signature:{arguments:[{type:{name:"any"},name:"e"}],return:{name:"any"}}},description:"",defaultValue:{value:"(e) => e.target.value",computed:!1}},rules:{required:!1,tsType:{name:"Array",elements:[{name:"union",raw:"RuleItem | CustomRuleFunc",elements:[{name:"RuleItem"},{name:"signature",type:"function",raw:"({ getFieldValue }: any) => RuleItem",signature:{arguments:[{type:{name:"any"},name:""}],return:{name:"RuleItem"}}}]}],raw:"CustomRule[]"},description:"",defaultValue:{value:"[]",computed:!1}},validateTrigger:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'"onBlur"',computed:!1}}}};var input=__webpack_require__("./src/components/Input/input.tsx"),Button_button=__webpack_require__("./src/components/Button/button.tsx");const form_stories={title:"Form 表单",component:Form_form,tags:["autodocs"],parameters:{layout:"centered"}},comfirmpsw=[{type:"string",required:!0,min:3,max:8},_ref=>{let{getFieldValue}=_ref;return{asyncValidator:(rule,value)=>new Promise(((resolve,reject)=>{value!==getFieldValue("password")&&reject("The two passwords that you entered do not match!"),setTimeout((()=>{resolve()}),1e3)}))}}],handleFinish=values=>{console.log(values,"value of submit successed")},handleFinishFailed=(values,errors)=>{console.log(values,"value of submit failed"),console.log(errors,"error info of submit errored")},Default=()=>{const ref=(0,react.useRef)(),resetForm=()=>{var _ref$current;console.log(ref.current,"ref"),null===(_ref$current=ref.current)||void 0===_ref$current||_ref$current.resetFieldValue()};return(0,jsx_runtime.jsx)(Form_form,{name:"clhnb-form",initialValue:{username:"clking@qq.com",password:"123",argeement:!1},onFinish:handleFinish,onFinishFailed:handleFinishFailed,ref,children:_ref2=>{let{isValid,isSubmitting}=_ref2;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(formItem,{label:"账号",name:"username",rules:[{type:"email",required:!0}],children:(0,jsx_runtime.jsx)(input.p,{type:"text"})}),(0,jsx_runtime.jsx)(formItem,{label:"密码",name:"password",rules:[{type:"string",required:!0,min:3,max:8}],children:(0,jsx_runtime.jsx)(input.p,{type:"password"})}),(0,jsx_runtime.jsx)(formItem,{label:"重复密码",name:"comfirmpsw",rules:comfirmpsw,children:(0,jsx_runtime.jsx)(input.p,{type:"password"})}),(0,jsx_runtime.jsxs)("div",{className:"agreement-section",style:{display:"flex",justifyContent:"center"},children:[(0,jsx_runtime.jsx)(formItem,{name:"argeement",valuePropName:"checked",getValueFromEvent:e=>e.target.checked,rules:[{type:"enum",enum:[!0]}],children:(0,jsx_runtime.jsx)(input.p,{type:"checkbox"})}),(0,jsx_runtime.jsxs)("span",{className:"agree-text",children:["注册即同意",(0,jsx_runtime.jsx)("a",{href:"http://localhost:6006/",children:"用户协议"})]})]}),(0,jsx_runtime.jsxs)("div",{className:"clking-form-submit-area",children:[(0,jsx_runtime.jsxs)(Button_button.A,{type:"submit",btnType:"primary",children:["提交 ",isSubmitting?"验证中":"验证完毕"," ",isValid?"通过(*^▽^*)":"未通过(╥﹏╥)"]}),(0,jsx_runtime.jsx)(Button_button.A,{onClick:resetForm,type:"button",btnType:"danger",children:"重置"})]})]})}})};Default.storyName="自定义规则，调用表单实例",Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:'() => {\n  const ref = useRef<IFormRef>();\n  const resetForm = () => {\n    console.log(ref.current, "ref");\n    ref.current?.resetFieldValue();\n  };\n  return <Form name="clhnb-form" initialValue={{\n    username: "clking@qq.com",\n    password: "123",\n    argeement: false\n  }} onFinish={handleFinish} onFinishFailed={handleFinishFailed} ref={ref}>\r\n      {({\n      isValid,\n      isSubmitting\n    }) => <>\r\n          <FormItem label="账号" name="username" rules={[{\n        type: "email",\n        required: true\n      }]}>\r\n            <Input type="text"></Input>\r\n          </FormItem>\r\n          <FormItem label="密码" name="password" rules={[{\n        type: "string",\n        required: true,\n        min: 3,\n        max: 8\n      }]}>\r\n            <Input type="password"></Input>\r\n          </FormItem>\r\n          <FormItem label="重复密码" name="comfirmpsw" rules={comfirmpsw}>\r\n            <Input type="password"></Input>\r\n          </FormItem>\r\n          <div className="agreement-section" style={{\n        display: "flex",\n        justifyContent: "center"\n      }}>\r\n            <FormItem name="argeement" valuePropName="checked" getValueFromEvent={e => e.target.checked} rules={[{\n          type: "enum",\n          enum: [true]\n        }]}>\r\n              <Input type="checkbox"></Input>\r\n            </FormItem>\r\n            <span className="agree-text">\r\n              注册即同意<a href="http://localhost:6006/">用户协议</a>\r\n            </span>\r\n          </div>\r\n          <div className="clking-form-submit-area">\r\n            <Button type="submit" btnType="primary">\r\n              提交 {isSubmitting ? "验证中" : "验证完毕"} {isValid ? "通过(*^▽^*)" : "未通过(╥﹏╥)"}\r\n            </Button>\r\n            <Button onClick={resetForm} type="button" btnType="danger">\r\n              重置\r\n            </Button>\r\n          </div>\r\n        </>}\r\n    </Form>;\n}',...Default.parameters?.docs?.source}}};const __namedExportsOrder=["Default"]},"./src/components/Button/button.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$:()=>Button,A:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("./node_modules/react/index.js");var classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/jsx-runtime.js");const Button=props=>{const{btnType,className,disabled,size,children,href,...restProps}=props,classes=classnames__WEBPACK_IMPORTED_MODULE_1___default()("btn",className,{["btn-".concat(btnType)]:btnType,["btn-".concat(size)]:size,disabled:"link"===btnType&&disabled});return"link"===btnType&&href?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("a",{className:classes,href,...restProps,children}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("button",{className:classes,disabled,...restProps,children})};Button.defaultProps={disabled:!1,btnType:"default"};const __WEBPACK_DEFAULT_EXPORT__=Button;Button.__docgenInfo={description:"页面中最常用的的按钮元素，适合于完成特定的交互，支持 HTML button 和 a 链接 的所有属性\r\n### 引用方法\r\n\r\n```javascript\r\nimport { Button } from 'clkingship'\r\n```",methods:[],displayName:"Button",props:{disabled:{defaultValue:{value:"false",computed:!1},required:!1},btnType:{defaultValue:{value:'"default"',computed:!1},required:!1}}}},"./src/components/Icon/icon.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("./node_modules/react/index.js");var classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),_fortawesome_react_fontawesome__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@fortawesome/react-fontawesome/index.es.js"),_fortawesome_fontawesome_svg_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@fortawesome/fontawesome-svg-core/index.mjs"),_fortawesome_free_solid_svg_icons__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@fortawesome/free-solid-svg-icons/index.mjs"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/react/jsx-runtime.js");_fortawesome_fontawesome_svg_core__WEBPACK_IMPORTED_MODULE_3__.Yv.add(_fortawesome_free_solid_svg_icons__WEBPACK_IMPORTED_MODULE_5__.X7I);const Icon=props=>{const{className,theme,...restProps}=props,classes=classnames__WEBPACK_IMPORTED_MODULE_1___default()("clking-icon",className,{["icon-".concat(theme)]:theme});return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_fortawesome_react_fontawesome__WEBPACK_IMPORTED_MODULE_2__.g,{className:classes,...restProps})},__WEBPACK_DEFAULT_EXPORT__=Icon;Icon.__docgenInfo={description:"",methods:[],displayName:"Icon",props:{theme:{required:!1,tsType:{name:"union",raw:'"primary" | "secondary" | "success" | "info" | "warning" | "danger" | "light" | "dark"',elements:[{name:"literal",value:'"primary"'},{name:"literal",value:'"secondary"'},{name:"literal",value:'"success"'},{name:"literal",value:'"info"'},{name:"literal",value:'"warning"'},{name:"literal",value:'"danger"'},{name:"literal",value:'"light"'},{name:"literal",value:'"dark"'}]},description:""}},composes:["FontAwesomeIconProps"]}},"./src/components/Input/input.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__,p:()=>Input});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),_Icon_icon__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/components/Icon/icon.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/jsx-runtime.js");const Input=(0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(((props,ref)=>{const{disabled,size,icon,prepend,append,style,...restProps}=props,classes=classnames__WEBPACK_IMPORTED_MODULE_1___default()("clking-input-wrapper",{["input-size-".concat(size)]:size,"is-disabled":disabled,"input-group":prepend||append,"input-group-append":!!append,"input-group-prepend":!!prepend});var value;return"value"in props&&(delete restProps.defaultValue,restProps.value=null==(value=props.value)?"":value),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)("div",{className:classes,style,children:[prepend&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{className:"clking-input-group-prepend",children:prepend}),icon&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{className:"icon-wrapper",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_Icon_icon__WEBPACK_IMPORTED_MODULE_3__.A,{icon,title:"title-".concat(icon)})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("input",{ref,className:"clking-input-inner",disabled,...restProps}),append&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{className:"clking-input-group-append",children:append})]})})),__WEBPACK_DEFAULT_EXPORT__=Input;Input.__docgenInfo={description:"Input 输入框 通过鼠标或键盘输入内容，是最基础的表单域的包装。\r\n\r\n~~~js\r\n// 这样引用\r\nimport { Input } from 'clkingship'\r\n~~~\r\n\r\n支持 HTMLInput 的所有基本属性",methods:[],displayName:"Input",props:{disabled:{required:!1,tsType:{name:"boolean"},description:""},size:{required:!1,tsType:{name:"union",raw:'"lg" | "sm"',elements:[{name:"literal",value:'"lg"'},{name:"literal",value:'"sm"'}]},description:"尺寸大小"},icon:{required:!1,tsType:{name:"IconProp"},description:"icon图标"},prepend:{required:!1,tsType:{name:"union",raw:"string | ReactElement",elements:[{name:"string"},{name:"ReactElement"}]},description:"前缀"},append:{required:!1,tsType:{name:"union",raw:"string | ReactElement",elements:[{name:"string"},{name:"ReactElement"}]},description:"后缀"},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(e: ChangeEvent<HTMLInputElement>) => void",signature:{arguments:[{type:{name:"ChangeEvent",elements:[{name:"HTMLInputElement"}],raw:"ChangeEvent<HTMLInputElement>"},name:"e"}],return:{name:"void"}}},description:""},ref:{required:!1,tsType:{name:"any"},description:""}},composes:["Omit"]}}}]);